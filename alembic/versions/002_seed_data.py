"""Seed test data

Revision ID: 002_seed_data
Revises: 001_initial_schema
Create Date: 2025-01-19

Заполнение БД тестовыми данными:
- 5 зданий в разных точках Москвы
- Дерево деятельностей глубиной 3 уровня
- 10 организаций с разными комбинациями деятельностей
"""
from typing import Sequence, Union
from alembic import op
import sqlalchemy as sa

# revision identifiers
revision: str = '002_seed_data'
down_revision: Union[str, None] = '001_initial_schema'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ==================== Здания ====================
    # 5 зданий в разных районах Москвы
    op.execute("""
        INSERT INTO buildings (id, address, latitude, longitude) VALUES
        (1, 'г. Москва, ул. Тверская, д. 1', 55.7558, 37.6173),
        (2, 'г. Москва, ул. Арбат, д. 10', 55.7520, 37.5920),
        (3, 'г. Москва, Ленинский проспект, д. 25', 55.7100, 37.5800),
        (4, 'г. Москва, ул. Новый Арбат, д. 15', 55.7530, 37.5850),
        (5, 'г. Москва, Кутузовский проспект, д. 32', 55.7400, 37.5500);
    """)
    
    # ==================== Деятельности ====================
    # Уровень 1: Корневые категории
    op.execute("""
        INSERT INTO activities (id, name, parent_id, level) VALUES
        (1, 'Еда', NULL, 1),
        (2, 'Автомобили', NULL, 1),
        (3, 'Услуги', NULL, 1),
        (4, 'Медицина', NULL, 1);
    """)
    
    # Уровень 2: Подкатегории
    op.execute("""
        INSERT INTO activities (id, name, parent_id, level) VALUES
        (5, 'Мясная продукция', 1, 2),
        (6, 'Молочная продукция', 1, 2),
        (7, 'Выпечка', 1, 2),
        (8, 'Грузовые', 2, 2),
        (9, 'Легковые', 2, 2),
        (10, 'Ремонт техники', 3, 2),
        (11, 'Юридические услуги', 3, 2),
        (12, 'Стоматология', 4, 2),
        (13, 'Терапия', 4, 2);
    """)
    
    # Уровень 3: Подкатегории 3-го уровня
    op.execute("""
        INSERT INTO activities (id, name, parent_id, level) VALUES
        (14, 'Запчасти', 9, 3),
        (15, 'Аксессуары', 9, 3),
        (16, 'Шиномонтаж', 9, 3),
        (17, 'Ремонт телефонов', 10, 3),
        (18, 'Ремонт компьютеров', 10, 3),
        (19, 'Хлеб', 7, 3),
        (20, 'Кондитерские изделия', 7, 3);
    """)
    
    # ==================== Организации ====================
    op.execute("""
        INSERT INTO organizations (id, name, phone_numbers, building_id) VALUES
        (1, 'ООО "Мясной Дом"', ARRAY['+7-495-111-1111', '+7-495-111-1112'], 1),
        (2, 'АО "Молочный Рай"', ARRAY['+7-495-222-2222'], 1),
        (3, 'ИП Иванов "АвтоЗапчасти"', ARRAY['+7-495-333-3333', '+7-495-333-3334'], 2),
        (4, 'ООО "Правовая Защита"', ARRAY['+7-495-444-4444'], 2),
        (5, 'Клиника "Здоровая Улыбка"', ARRAY['+7-495-555-5555', '+7-495-555-5556'], 3),
        (6, 'СТО "Грузовик Сервис"', ARRAY['+7-495-666-6666'], 3),
        (7, 'Пекарня "Свежий Хлеб"', ARRAY['+7-495-777-7777'], 4),
        (8, 'Сервисный центр "ТехноМастер"', ARRAY['+7-495-888-8888', '+7-495-888-8889'], 4),
        (9, 'Автосалон "Премиум Авто"', ARRAY['+7-495-999-9999'], 5),
        (10, 'Медицинский центр "Здоровье"', ARRAY['+7-495-000-0000', '+7-495-000-0001'], 5);
    """)
    
    # ==================== Связи организаций с деятельностями ====================
    op.execute("""
        INSERT INTO organization_activities (organization_id, activity_id) VALUES
        -- ООО "Мясной Дом" - Еда, Мясная продукция
        (1, 1), (1, 5),
        -- АО "Молочный Рай" - Еда, Молочная продукция  
        (2, 1), (2, 6),
        -- ИП Иванов "АвтоЗапчасти" - Автомобили, Легковые, Запчасти
        (3, 2), (3, 9), (3, 14),
        -- ООО "Правовая Защита" - Услуги, Юридические услуги
        (4, 3), (4, 11),
        -- Клиника "Здоровая Улыбка" - Медицина, Стоматология
        (5, 4), (5, 12),
        -- СТО "Грузовик Сервис" - Автомобили, Грузовые
        (6, 2), (6, 8),
        -- Пекарня "Свежий Хлеб" - Еда, Выпечка, Хлеб
        (7, 1), (7, 7), (7, 19),
        -- Сервисный центр "ТехноМастер" - Услуги, Ремонт техники, Ремонт телефонов, Ремонт компьютеров
        (8, 3), (8, 10), (8, 17), (8, 18),
        -- Автосалон "Премиум Авто" - Автомобили, Легковые, Аксессуары
        (9, 2), (9, 9), (9, 15),
        -- Медицинский центр "Здоровье" - Медицина, Терапия, Стоматология
        (10, 4), (10, 12), (10, 13);
    """)
    
    # Сбрасываем sequence для корректной работы автоинкремента
    op.execute("SELECT setval('buildings_id_seq', 5);")
    op.execute("SELECT setval('activities_id_seq', 20);")
    op.execute("SELECT setval('organizations_id_seq', 10);")


def downgrade() -> None:
    op.execute("DELETE FROM organization_activities;")
    op.execute("DELETE FROM organizations;")
    op.execute("DELETE FROM activities;")
    op.execute("DELETE FROM buildings;")
